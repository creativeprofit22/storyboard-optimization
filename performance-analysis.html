<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Performance Analysis - Framer Motion Scroll Animations</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #0a0a0a;
      color: #f0f0f0;
    }
    h1, h2 { color: #ff6b35; }
    .metric-card {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 20px;
      margin: 15px 0;
    }
    .metric-value {
      font-size: 2em;
      font-weight: bold;
      color: #4ade80;
    }
    .metric-label {
      color: #888;
      font-size: 0.9em;
      text-transform: uppercase;
    }
    .warning { color: #fbbf24; }
    .error { color: #ef4444; }
    .good { color: #4ade80; }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
    }
    pre {
      background: #0a0a0a;
      border: 1px solid #333;
      padding: 15px;
      overflow-x: auto;
      border-radius: 4px;
    }
    .fps-meter {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      padding: 10px 15px;
      border-radius: 4px;
      border: 2px solid #ff6b35;
      z-index: 10000;
    }
    button {
      background: #ff6b35;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover { background: #e55525; }
  </style>
</head>
<body>
  <h1>Performance Analysis Report</h1>
  <p>Analyzing Framer Motion scroll animations on Creative Profit Agency website</p>
  
  <div class="fps-meter">
    <div class="metric-label">FPS</div>
    <div id="fps" class="metric-value">--</div>
  </div>

  <div>
    <button onclick="runPerformanceTests()">Run Performance Tests</button>
    <button onclick="measureWebVitals()">Measure Web Vitals</button>
    <button onclick="analyzeAnimations()">Analyze Animations</button>
  </div>

  <h2>Core Web Vitals</h2>
  <div class="grid" id="web-vitals">
    <div class="metric-card">
      <div class="metric-label">Largest Contentful Paint (LCP)</div>
      <div id="lcp" class="metric-value">--</div>
      <small>Target: &lt;2.5s (Good), &lt;4s (Needs Improvement)</small>
    </div>
    <div class="metric-card">
      <div class="metric-label">First Input Delay (FID)</div>
      <div id="fid" class="metric-value">--</div>
      <small>Target: &lt;100ms (Good), &lt;300ms (Needs Improvement)</small>
    </div>
    <div class="metric-card">
      <div class="metric-label">Cumulative Layout Shift (CLS)</div>
      <div id="cls" class="metric-value">--</div>
      <small>Target: &lt;0.1 (Good), &lt;0.25 (Needs Improvement)</small>
    </div>
  </div>

  <h2>Animation Performance</h2>
  <div class="grid">
    <div class="metric-card">
      <div class="metric-label">Average FPS During Scroll</div>
      <div id="avg-fps" class="metric-value">--</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Dropped Frames</div>
      <div id="dropped-frames" class="metric-value">--</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Animation Frame Time</div>
      <div id="frame-time" class="metric-value">--</div>
    </div>
  </div>

  <h2>Bundle Size Analysis</h2>
  <div class="metric-card">
    <div class="metric-label">First Load JS</div>
    <div id="bundle-size" class="metric-value">125 kB</div>
    <pre id="bundle-breakdown">
Main Bundle: 125 kB
  - React: ~87.2 kB (shared)
  - Framer Motion: ~30-35 kB (estimated in chunk 117)
  - Page Code: ~37.6 kB
  - Other: ~2 kB
    </pre>
  </div>

  <h2>IntersectionObserver Performance</h2>
  <div class="metric-card">
    <div id="observer-stats">Loading...</div>
  </div>

  <h2>Paint & Layout Performance</h2>
  <div class="metric-card">
    <div id="paint-stats">Loading...</div>
  </div>

  <h2>CPU Usage Analysis</h2>
  <div class="metric-card">
    <div id="cpu-stats">Loading...</div>
  </div>

  <script>
    // FPS Monitoring
    let lastFrameTime = performance.now();
    let frames = [];
    let fpsHistory = [];

    function measureFPS() {
      const now = performance.now();
      const delta = now - lastFrameTime;
      const fps = Math.round(1000 / delta);
      
      frames.push(fps);
      if (frames.length > 60) frames.shift();
      
      const avgFps = Math.round(frames.reduce((a, b) => a + b, 0) / frames.length);
      document.getElementById('fps').textContent = avgFps;
      document.getElementById('fps').className = avgFps >= 55 ? 'metric-value good' : avgFps >= 30 ? 'metric-value warning' : 'metric-value error';
      
      lastFrameTime = now;
      requestAnimationFrame(measureFPS);
    }
    measureFPS();

    // Web Vitals Measurement
    function measureWebVitals() {
      // LCP
      new PerformanceObserver((list) => {
        const entries = list.getEntries();
        const lastEntry = entries[entries.length - 1];
        const lcp = lastEntry.renderTime || lastEntry.loadTime;
        document.getElementById('lcp').textContent = (lcp / 1000).toFixed(2) + 's';
        document.getElementById('lcp').className = lcp < 2500 ? 'metric-value good' : lcp < 4000 ? 'metric-value warning' : 'metric-value error';
      }).observe({ entryTypes: ['largest-contentful-paint'] });

      // CLS
      let clsValue = 0;
      new PerformanceObserver((list) => {
        for (const entry of list.getEntries()) {
          if (!entry.hadRecentInput) {
            clsValue += entry.value;
          }
        }
        document.getElementById('cls').textContent = clsValue.toFixed(3);
        document.getElementById('cls').className = clsValue < 0.1 ? 'metric-value good' : clsValue < 0.25 ? 'metric-value warning' : 'metric-value error';
      }).observe({ entryTypes: ['layout-shift'] });

      // FID/INP simulation
      let fidValue = 0;
      new PerformanceObserver((list) => {
        for (const entry of list.getEntries()) {
          fidValue = Math.max(fidValue, entry.processingStart - entry.startTime);
        }
        document.getElementById('fid').textContent = fidValue.toFixed(0) + 'ms';
        document.getElementById('fid').className = fidValue < 100 ? 'metric-value good' : fidValue < 300 ? 'metric-value warning' : 'metric-value error';
      }).observe({ entryTypes: ['first-input', 'event'] });
    }

    // Animation Performance Analysis
    function analyzeAnimations() {
      let frameCount = 0;
      let droppedFrames = 0;
      let frameTimes = [];
      let startTime = performance.now();

      function measureFrame() {
        const now = performance.now();
        const delta = now - lastFrameTime;
        
        frameTimes.push(delta);
        frameCount++;
        
        if (delta > 16.67 * 2) droppedFrames++; // Dropped if > 2 frames worth
        
        if (frameCount < 180) { // Measure for 3 seconds
          requestAnimationFrame(measureFrame);
        } else {
          const avgFrameTime = frameTimes.reduce((a, b) => a + b, 0) / frameTimes.length;
          const avgFps = Math.round(1000 / avgFrameTime);
          
          document.getElementById('avg-fps').textContent = avgFps;
          document.getElementById('dropped-frames').textContent = droppedFrames;
          document.getElementById('frame-time').textContent = avgFrameTime.toFixed(2) + 'ms';
          
          document.getElementById('avg-fps').className = avgFps >= 55 ? 'metric-value good' : avgFps >= 30 ? 'metric-value warning' : 'metric-value error';
        }
        
        lastFrameTime = now;
      }
      
      requestAnimationFrame(measureFrame);
    }

    // IntersectionObserver Analysis
    function analyzeObservers() {
      const observers = [];
      let observerCount = 0;
      let observedElements = 0;
      
      // Try to estimate observers (this is approximate)
      const animatedSections = document.querySelectorAll('[data-animated], .animate, motion-div');
      observedElements = animatedSections.length;
      
      document.getElementById('observer-stats').innerHTML = `
        <div class="metric-label">IntersectionObserver Stats</div>
        <p>Estimated Observers: ${observerCount || 'N/A (requires runtime inspection)'}</p>
        <p>Animated Elements: ${observedElements}</p>
        <p>Threshold: 0.1 (single threshold - optimal)</p>
        <p>RootMargin: 0px 0px -100px 0px (good for preloading)</p>
        <p><strong class="good">✓ Observers disconnect after triggering (optimal)</strong></p>
      `;
    }

    // Paint Performance
    function analyzePaint() {
      const paintEntries = performance.getEntriesByType('paint');
      let paintStats = '<div class="metric-label">Paint Performance</div>';
      
      paintEntries.forEach(entry => {
        paintStats += `<p>${entry.name}: ${entry.startTime.toFixed(2)}ms</p>`;
      });
      
      // Check for layout thrashing indicators
      const layoutShifts = performance.getEntriesByType('layout-shift');
      paintStats += `<p>Layout Shifts Detected: ${layoutShifts.length}</p>`;
      
      document.getElementById('paint-stats').innerHTML = paintStats;
    }

    // CPU Usage (approximated via long tasks)
    function analyzeCPU() {
      new PerformanceObserver((list) => {
        const longTasks = list.getEntries();
        let cpuStats = '<div class="metric-label">CPU Performance</div>';
        cpuStats += `<p>Long Tasks (>50ms): ${longTasks.length}</p>`;
        
        if (longTasks.length > 0) {
          const avgDuration = longTasks.reduce((sum, task) => sum + task.duration, 0) / longTasks.length;
          cpuStats += `<p>Average Long Task Duration: ${avgDuration.toFixed(2)}ms</p>`;
          cpuStats += `<p class="${longTasks.length > 10 ? 'error' : 'warning'}">⚠ Long tasks may cause jank</p>`;
        } else {
          cpuStats += `<p class="good">✓ No significant long tasks detected</p>`;
        }
        
        document.getElementById('cpu-stats').innerHTML = cpuStats;
      }).observe({ entryTypes: ['longtask'] });
      
      // Fallback if no long tasks yet
      setTimeout(() => {
        if (document.getElementById('cpu-stats').textContent === 'Loading...') {
          document.getElementById('cpu-stats').innerHTML = '<div class="metric-label">CPU Performance</div><p class="good">✓ No long tasks detected (under 50ms)</p>';
        }
      }, 3000);
    }

    // Run initial analysis
    function runPerformanceTests() {
      measureWebVitals();
      analyzeAnimations();
      analyzeObservers();
      analyzePaint();
      analyzeCPU();
    }

    // Auto-run on load
    window.addEventListener('load', () => {
      setTimeout(runPerformanceTests, 1000);
    });

    // Initial setup
    analyzeObservers();
    analyzePaint();
    analyzeCPU();
  </script>
</body>
</html>
